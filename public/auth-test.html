<!DOCTYPE html>
<html>
<head>
    <title>Admin Auth Test</title>
    <script type="module">
        // Firebase configuration
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyA9ZAV7HoUUTaEzbGPz9_M4iFeiLDYmLBo",
            authDomain: "evenour-auth-app.firebaseapp.com",
            projectId: "evenour-auth-app",
            storageBucket: "evenour-auth-app.appspot.com",
            messagingSenderId: "228539073003",
            appId: "1:228539073003:web:64669dd81f0454db1459ae"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Test authentication and token storage
        async function testAuth() {
            console.log('Testing Firebase authentication...');
            
            try {
                // Sign in
                const userCredential = await signInWithEmailAndPassword(auth, 'evenour.in@gmail.com', 'Hayyaan123@1');
                console.log('✅ Login successful:', userCredential.user.uid);
                
                // Get token
                const token = await userCredential.user.getIdToken();
                console.log('✅ Token obtained:', token.substring(0, 50) + '...');
                
                // Store token in localStorage (like the AuthContext should do)
                localStorage.setItem('firebaseToken', token);
                console.log('✅ Token stored in localStorage');
                
                // Test API call with token
                const response = await fetch('http://localhost:3002/api/admin/dashboard/metrics', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('API Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('✅ API call successful:', data);
                } else {
                    const error = await response.text();
                    console.log('❌ API call failed:', error);
                }
                
            } catch (error) {
                console.error('❌ Test failed:', error);
            }
        }

        // Run test when page loads
        window.addEventListener('load', testAuth);
        
        // Also listen for auth state changes
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log('Auth state changed - user logged in:', user.uid);
                const token = await user.getIdToken();
                localStorage.setItem('firebaseToken', token);
                console.log('Token updated in localStorage');
            } else {
                console.log('Auth state changed - user logged out');
                localStorage.removeItem('firebaseToken');
            }
        });
    </script>
</head>
<body>
    <h1>Admin Auth Test</h1>
    <p>Check the browser console for test results.</p>
    <button onclick="console.log('Current token:', localStorage.getItem('firebaseToken'))">Check Token</button>
    <button onclick="localStorage.removeItem('firebaseToken'); console.log('Token cleared')">Clear Token</button>
</body>
</html>
